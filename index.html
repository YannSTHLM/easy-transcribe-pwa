<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Easy Transcribe PWA</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="AI-powered audio transcription app that works offline. Store your API key locally and never lose your transcription history.">
    <meta name="theme-color" content="#2563eb">
    <meta name="background-color" content="#ffffff">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%232563eb'/><text x='50' y='60' font-size='50' text-anchor='middle' fill='white'>üé§</text></svg>">
    
    <!-- Apple Mobile Web App -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="EasyTranscribe">
    
    <!-- Microsoft Tiles -->
    <meta name="msapplication-TileColor" content="#2563eb">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='90' font-size='90'>üé§</text></svg>">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <!-- Install Banner -->
    <div id="installBanner" class="install-banner" style="display: none;">
        <div class="install-content">
            <div class="install-icon">üì±</div>
            <div class="install-text">
                <h4>Install Easy Transcribe</h4>
                <p>Get the full app experience on your device</p>
            </div>
            <div class="install-actions">
                <button id="installBtn" class="btn btn-primary btn-small">Install</button>
                <button id="dismissInstall" class="btn-icon">‚úï</button>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="app-title">
                    <div class="app-icon">üé§</div>
                    <h1>Easy Transcribe</h1>
                </div>
                <div class="header-status">
                    <div class="connection-status">
                        <div id="statusIndicator" class="indicator online"></div>
                        <span id="connectionStatus" class="status online">Online</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="app-nav">
            <button class="nav-btn active" data-view="transcribe">
                <span class="nav-icon">üé§</span>
                <span class="nav-label">Transcribe</span>
            </button>
            <button class="nav-btn" data-view="history">
                <span class="nav-icon">üìö</span>
                <span class="nav-label">History</span>
                <span id="historyCount" class="nav-badge">0</span>
            </button>
            <button class="nav-btn" data-view="settings">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-label">Settings</span>
            </button>
        </nav>

        <!-- Main Content -->
        <main class="app-main">
            <!-- Transcribe View -->
            <div id="transcribeView" class="view active">
                <!-- Configuration Section -->
                <section class="config-section">
                    <h3 class="section-title">Configuration</h3>
                    
                    <!-- API Key Configuration -->
                    <div class="config-group">
                        <label for="apiKeyInput" class="config-label">
                            <span class="config-icon">üîë</span>
                            Groq API Key
                            <span class="config-required">*</span>
                        </label>
                        <div class="input-group">
                            <input 
                                type="password" 
                                id="apiKeyInput" 
                                class="config-input" 
                                placeholder="Enter your Groq API key..."
                                autocomplete="off"
                            >
                            <button type="button" class="toggle-visibility" id="toggleApiKey" title="Show/Hide API Key">üëÅÔ∏è</button>
                        </div>
                        <div class="config-options">
                            <label class="checkbox-label">
                                <input type="checkbox" id="autoSaveApiKey">
                                <span class="checkmark"></span>
                                Save API key locally (encrypted)
                            </label>
                        </div>
                        <small class="config-help">
                            Get your free API key at <a href="https://groq.com/" target="_blank" rel="noopener">groq.com</a>
                        </small>
                    </div>

                    <!-- Model Selection -->
                    <div class="config-group">
                        <label for="modelSelect" class="config-label">
                            <span class="config-icon">ü§ñ</span>
                            Transcription Model
                        </label>
                        <select id="modelSelect" class="config-select">
                            <option value="whisper-large-v3">Whisper Large v3 (Best Quality)</option>
                            <option value="whisper-large-v3-turbo">Whisper Large v3 Turbo (Faster)</option>
                            <option value="distil-whisper-large-v3-en">Distil Whisper Large v3 (English Only)</option>
                        </select>
                    </div>

                    <!-- Language Selection -->
                    <div class="config-group">
                        <label for="languageSelect" class="config-label">
                            <span class="config-icon">üåç</span>
                            Language (Optional)
                        </label>
                        <select id="languageSelect" class="config-select">
                            <option value="">Auto-detect</option>
                            <option value="en">English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                            <option value="it">Italian</option>
                            <option value="pt">Portuguese</option>
                            <option value="ru">Russian</option>
                            <option value="ja">Japanese</option>
                            <option value="ko">Korean</option>
                            <option value="zh">Chinese</option>
                            <option value="ar">Arabic</option>
                            <option value="hi">Hindi</option>
                            <option value="nl">Dutch</option>
                            <option value="pl">Polish</option>
                            <option value="tr">Turkish</option>
                        </select>
                    </div>

                    <!-- Configuration Actions -->
                    <div class="config-actions">
                        <button type="button" class="btn btn-outline" id="validateBtn">
                            <span class="btn-icon">‚úì</span>
                            Validate API Key
                        </button>
                    </div>
                </section>

                <!-- Upload Section -->
                <section class="upload-section">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-content">
                            <div class="upload-icon">üìÅ</div>
                            <h3>Drop your audio file here</h3>
                            <p>or <button type="button" class="browse-btn" id="browseBtn">browse files</button></p>
                            <small class="upload-info">
                                Supported formats: MP3, WAV, M4A, AAC, OGG, FLAC<br>
                                Maximum file size: 25MB
                            </small>
                        </div>
                        <input type="file" id="audioFileInput" accept="audio/*" hidden>
                    </div>

                    <!-- File Info -->
                    <div class="file-info" id="fileInfo" style="display: none;">
                        <div class="file-details">
                            <span class="file-icon">üéµ</span>
                            <div class="file-meta">
                                <div class="file-name" id="fileName"></div>
                                <div class="file-size" id="fileSize"></div>
                            </div>
                            <button type="button" class="remove-file" id="removeFile">√ó</button>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="progress-container" id="progressContainer" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-text" id="progressText">Processing...</div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <button type="button" class="btn btn-primary" id="transcribeBtn" disabled>
                            <span class="btn-icon">üîß</span>
                            Validate API Key First
                        </button>
                    </div>
                </section>

                <!-- Results Section -->
                <section class="results-section" id="resultsSection" style="display: none;">
                    <h3 class="section-title">Transcription Result</h3>
                    
                    <div class="transcription-container">
                        <div class="transcription-text" id="transcriptionText"></div>
                        <div class="transcription-actions">
                            <button type="button" class="btn btn-outline" id="copyBtn">
                                <span class="btn-icon">üìã</span>
                                Copy
                            </button>
                            <button type="button" class="btn btn-outline" id="downloadBtn">
                                <span class="btn-icon">üíæ</span>
                                Download
                            </button>
                            <button type="button" class="btn btn-primary" id="saveBtn">
                                <span class="btn-icon">üíæ</span>
                                Save to History
                            </button>
                        </div>
                    </div>
                </section>
            </div>

            <!-- History View -->
            <div id="historyView" class="view">
                <section class="history-section">
                    <div class="section-header">
                        <h3 class="section-title">Transcription History</h3>
                        <div class="section-actions">
                            <button type="button" class="btn btn-outline btn-small" id="exportBtn">
                                <span class="btn-icon">üì§</span>
                                Export
                            </button>
                            <button type="button" class="btn btn-outline btn-small danger" id="clearHistoryBtn">
                                <span class="btn-icon">üóëÔ∏è</span>
                                Clear All
                            </button>
                        </div>
                    </div>
                    
                    <div class="history-container" id="historyContainer">
                        <div class="loading-spinner">Loading history...</div>
                    </div>
                </section>
            </div>

            <!-- Settings View -->
            <div id="settingsView" class="view">
                <section class="settings-section">
                    <h3 class="section-title">Settings</h3>
                    
                    <div class="settings-group">
                        <h4>Privacy & Security</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Auto-save API Key</label>
                                <p>Securely store your API key locally for convenience</p>
                            </div>
                            <div class="setting-control">
                                <label class="switch">
                                    <input type="checkbox" id="autoSaveToggle">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h4>Storage</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Storage Usage</label>
                                <p id="storageInfo">Calculating...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h4>App Information</h4>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Version</label>
                                <p>1.0.0 PWA</p>
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <label>Install Status</label>
                                <p id="installStatus">Web App</p>
                            </div>
                        </div>
                    </div>

                    <div class="settings-actions">
                        <button type="button" class="btn btn-outline danger" onclick="app.clearAllData()">
                            <span class="btn-icon">üóëÔ∏è</span>
                            Clear All Data
                        </button>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3>Processing your audio...</h3>
            <p>This may take a few moments depending on file size</p>
        </div>
    </div>

    <!-- Keyboard Shortcuts Help -->
    <div class="shortcuts-help" id="shortcutsHelp" style="display: none;">
        <h4>Keyboard Shortcuts</h4>
        <div class="shortcuts-list">
            <div class="shortcut">
                <kbd>Ctrl</kbd> + <kbd>U</kbd>
                <span>Upload file</span>
            </div>
            <div class="shortcut">
                <kbd>Ctrl</kbd> + <kbd>T</kbd>
                <span>Start transcription</span>
            </div>
            <div class="shortcut">
                <kbd>Ctrl</kbd> + <kbd>C</kbd>
                <span>Copy result</span>
            </div>
            <div class="shortcut">
                <kbd>Ctrl</kbd> + <kbd>H</kbd>
                <span>View history</span>
            </div>
            <div class="shortcut">
                <kbd>Ctrl</kbd> + <kbd>S</kbd>
                <span>Save transcription</span>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/storage.js"></script>
    <script src="/app.js"></script>
    <script src="/app-utils.js"></script>
    <script src="/ui-enhancements.js"></script>

    <!-- PWA Installation Script -->
    <script>
        // Check if app is already installed
        if (window.matchMedia('(display-mode: standalone)').matches) {
            document.getElementById('installStatus').textContent = 'Installed as PWA';
        }
        
        // Handle app shortcuts
        if (navigator.serviceWorker) {
            navigator.serviceWorker.addEventListener('message', event => {
                if (event.data && event.data.action) {
                    switch (event.data.action) {
                        case 'transcribe':
                            app?.switchView('transcribe');
                            break;
                        case 'history':
                            app?.switchView('history');
                            break;
                    }
                }
            });
        }
        
        // Register for push notifications (optional)
        if ('Notification' in window && 'serviceWorker' in navigator) {
            Notification.requestPermission();
        }
    </script>
</body>
</html>